language: nix
sudo: false
deploy:
  matrix:
  - provider: s3
  - provider: codedeploy
    access_key_id: AKIAJ2EXBYL3OEJQM6NA
    bucket: travis-penrose
    key: latest/ww.zip
    application: ww
    deployment_group: ww
  secret_access_key:
    secure: Xrs3ObXazm5VhoiM5/Y0RLeXE7aAhdr7wsdPWb5UqH5YsngaMrXcwOF2ibYLyrKxV/vmfH8wrG1grQpL5yng2WioqMq522fxr2HYz7ESydTMxY6ZPWMze+uffdJEP3eb1NySpIImyW8ZtBwkruanXtemrbzRSnz4salcbXJ+uKJEs3ynIBqWk+pd6BB2YTjdDOUI7+Ek7HRPe0gy0H/1gXWI0jfVjJYZ3KZZ/3ifonGzcKdN6ScOGw3GJ8+kKNidln0neOmGCc74mkCoabXP9cXhlKOyR1PZaWcuPxKm7MTI2RQKCN9wH8MORMc3rmpRVNlBXVHr9WZJXb3QKNlSBeguTP5CgTjzFZPqILXK3/i4h7nCs6cwKdqxNdiRdfQBPwVHL5EC8grGuHAOgQKeKDDS7k8FYabBPrF80Lo+0L2QQGEyuKAE8pETAqpYjPcBRFwiLkCoUv4xTvbBJbGEWVgXbxpAWjjPWbbn6MfWYH7bxKPD0vua1cTYhXDqVwAHiJDUpxEWxYZmCvnUa7//YiTwFKmzH21er7eu0cZDemNyHS8fKBIzGmAaXM93esfXMSinUYQB00AH/2j5F4TSE9YPqwJZM9mAFF9BC9hsAoEpGDrHZqLCzjNytxDbP3a21qYkDJfVh1JLmsV6oXD+ZEAJ5iTJyf1kAcbCoakrnAI=
cache:
  directories:
  - "$HOME/.ghc"
  - "$HOME/.cabal"
  - "$HOME/.stack"
  - ".stack-work"
matrix:
  fast_finish: true
  include:
  - env: GHCVER=8.2.1 CACHE_NAME=8.2.1 BUILD_BINARY=1
    compiler: ": #stack 8.2.1"
    addons:
      apt:
        packages:
        - ghc-8.2.1
        sources:
        - hvr-ghc
  - env: GHCVER=8.2.1 CACHE_NAME=8.2.1-osx BUILD_BINARY=1
    os: osx
    compiler: ": #stack 8.2.1"
    addons:
      apt:
        packages:
        - ghc-8.2.1
        sources:
        - hvr-ghc
install:
- unset CC
- export PATH=$HOME/.local/bin:/opt/ghc/$GHCVER/bin:$PATH
- "./.travis/install-ghr.sh"
- "./.travis/install-stack.sh"
- stack install alex happy
script:
- echo "$(ghc --version) [$(ghc --print-project-git-commit-id 2> /dev/null || echo
  '?')]"
- GHC_OPTIONS=""
- |
  set -ex
  # Run tests
  stack --no-terminal test --ghc-options="$GHC_OPTIONS"
  set +ex
after_success:
- |
  # Build and ship binary
  ./.travis/attach-binary.sh
